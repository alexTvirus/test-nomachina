# Use Ubuntu 22.04 as the base image
FROM ubuntu:22.04

# Set non-interactive frontend to avoid prompts
ENV DEBIAN_FRONTEND=noninteractive

# Install necessary packages
RUN apt-get update && apt-get install -y \
    xfce4 \
    xfce4-goodies \
    sudo \
    wget \
    git \
    nano \
    dbus-x11 \
    xauth \
    novnc \
    websockify \
    tigervnc-standalone-server && \
    apt-get clean

# Set up a user
RUN adduser --disabled-password --gecos "" user && \
    echo "user:password" | chpasswd && \
    adduser user sudo && \
    echo "xfce4-session" > /home/user/.xsession && \
    chown user:user /home/user/.xsession

# Set up VNC server
RUN mkdir -p /home/user/.vnc && \
    echo "password" | vncpasswd -f > /home/user/.vnc/passwd && \
    chown -R user:user /home/user/.vnc && \
    chmod 0600 /home/user/.vnc/passwd

# Expose web-based VNC port
EXPOSE 6080

# Start noVNC with TigerVNC
CMD ["/bin/sh", "-c", "vncserver :1 -geometry 1280x720 -depth 24 && websockify --web /usr/share/novnc/ 6080 localhost:5901"]
